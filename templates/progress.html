<!DOCTYPE html>
<html>
<head>
    <title>Analysis Progress</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 20px; max-width: 800px; margin: 0 auto; text-align: center; }
        .progress { height: 30px; margin: 20px 0; }
    </style>
</head>
<body>
    <h2 class="mb-4">Analyzing Comments...</h2>
    
    <div class="progress">
        <div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated" 
             role="progressbar" style="width: 0%"></div>
    </div>
    
    <p id="progressText">Initializing analysis...</p>
    <p class="text-muted">This may take several minutes for videos with many comments</p>
    
    <div id="resultsContainer" style="display: none;">
        <a id="resultsLink" href="#" class="btn btn-primary btn-lg">View Complete Results</a>
    </div>

    <script>
        const analysisId = "{{ analysis_id }}";
        let checkInterval = setInterval(checkProgress, 2000);
        
        function checkProgress() {
            fetch(`/check_status/${analysisId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'complete') {
                        clearInterval(checkInterval);
                        document.getElementById('progressBar').style.width = '100%';
                        document.getElementById('progressText').innerHTML = 
                            `Analysis complete! Processed ${data.total_comments} comments in ${data.processing_time} seconds`;
                        document.getElementById('resultsLink').href = `/results/${analysisId}`;
                        document.getElementById('resultsContainer').style.display = 'block';
                        document.getElementById('progressBar').classList.remove('progress-bar-animated');
                    } 
                    else if (data.status === 'error') {
                        clearInterval(checkInterval);
                        document.getElementById('progressText').innerHTML = 
                            `Error: ${data.error}`;
                        document.getElementById('progressBar').classList.remove('progress-bar-striped', 'progress-bar-animated');
                        document.getElementById('progressBar').classList.add('bg-danger');
                    }
                    else if (data.progress) {
                        document.getElementById('progressBar').style.width = `${data.progress}%`;
                        document.getElementById('progressText').innerHTML = 
                            `Processing... ${data.progress}% complete`;
                    }
                });
        }
    </script>
</body>
</html>